  <!doctype html>
  <title>Assignments & Tasks</title>
  <!-- List actions -->
  <div style="margin: .5rem 0 1rem;">
    <button type="button" id="btn-save-list">Save List</button>
    <select id="saved-lists" style="max-width: 16rem;">
      <option value="">Open saved list…</option>
    </select>
    <button type="button" id="btn-open-list">Open</button>

    <button type="button" id="btn-share-link">Share link</button>
    <button type="button" id="btn-export-ics">Export .ics</button>
    <input type="file" id="file-import-list" accept=".json" style="display:none;">
    <button type="button" id="btn-import-file">Import file</button>
    <!-- Add near your other action buttons -->
    <button type="button" id="btn-import-ics">Import .ics</button>
    <input type="file" id="file-import-ics" accept=".ics,text/calendar" style="display:none;">

  </div>

  <!-- load your helper JS (you already include script.js at the end) -->

  <h1>Assignments</h1>
  <form action="{{ url_for('create_assignment') }}" method="post" style="margin-bottom:1rem">
    <label>Title: <input name="assignment_title" required></label>
    <label>Due: <input type="date" name="assignment_due" required></label>
    <label>Priority (0–10): <input type="number" name="assignment_importance" min="0" max="10" value="5"></label> <!-- ⬅️ NEW -->
    <button type="submit">Add Assignment</button>
  </form>

  {% if assignments %}
    <ul>
      {% for a in assignments %}
        <li>
          <strong>{{ a.title }}</strong> (due {{ a.due_date }}, priority {{ a.importance }}) <!-- ⬅️ CHANGED -->
          {% if a.tasks %}
            <ul>
              {% for t in a.tasks %}
                <li>
                  <strong>{% if t.completed %}<s>{{ t.title }}</s>{% else %}{{ t.title }}{% endif %}</strong>
                  — start {{ t.start_date }}, dur {{ t.duration_days }}, order {{ t.order }} <!-- ⬅️ CHANGED -->
                  {% if t.description %}<div>: {{ t.description }}</div>{% endif %}
                  <!-- Note: edit/complete/delete are intentionally NOT here; they live in the bottom list -->
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div><em>No tasks yet.</em></div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No assignments yet.</p>
  {% endif %}

  <hr>

  <h2>Add Task</h2>
  <form action="{{ url_for('create_task') }}" method="post" id="add-task-form">
    <label>Assignment:
      <select name="assignment_id" id="assignment_id">
        <option value="0">— No assignment —</option>  <!-- standalone -->
        {% for a in assignments %}
          <option value="{{ a.id }}">{{ a.title }} (due {{ a.due_date }})</option>
        {% endfor %}
      </select>
    </label><br>

    <label>Title: <input name="title" required></label><br>
    <label>Description:<br>
      <textarea name="description" rows="3" cols="40"></textarea>
    </label><br>

    <!-- shown only for standalone by script.js -->
    <div id="standalone-fields">
      <label>Due date (standalone only):
        <input type="date" name="due_date" id="due_date">
      </label><br>
      <label>Priority (standalone):
        <input type="number" name="importance" id="importance" min="0" max="10" value="5">
      </label><br>
    </div>

    <label>Duration (days):
      <input type="number" name="duration_days" step="0.5" value="1">
    </label><br>

    <!-- shown only when an assignment is selected -->
    <div id="assignment-fields">
      <label>Order (1..N in assignment):
        <input type="number" name="order" id="order" min="1" value="1">
      </label><br>
    </div>

    <button type="submit">Add Task</button>
  </form>

  <hr>

  <h2>All Tasks (by start date)</h2>
  <ol>
    {% for t in tasks %}
      <li>
        <strong>{% if t.completed %}<s>{{ t.title }}</s>{% else %}{{ t.title }}{% endif %}</strong>
        — start {{ t.start_date }}, due {{ t.due_date }},
        dur {{ t.duration_days }}, priority {{ t.importance }}, order {{ t.order }}
        {% if t.assignment_title %}
          <div><em>{{ t.assignment_title }}</em>{% if t.description %}: {{ t.description }}{% endif %}</div>
        {% elif t.description %}
          <div>{{ t.description }}</div>
        {% endif %}

        <!-- actions live here (as you wanted) -->
        {% if not t.completed %}
          <form action="{{ url_for('complete_task', task_id=t.id) }}" method="post" style="display:inline">
            <button type="submit">Complete</button>
          </form>
        {% else %}
          <form action="{{ url_for('uncomplete_task', task_id=t.id) }}" method="post" style="display:inline">
            <button type="submit">Uncomplete</button>
          </form>
        {% endif %}
        <form action="{{ url_for('delete_task', task_id=t.id) }}" method="post" style="display:inline" onsubmit="return confirm('Delete this task?');">
          <button type="submit">Delete</button>
        </form>

        <!-- ⬅️ CHANGED: edit form only in bottom list.
            Standalone can edit due/priority; assignment-backed can't (they inherit). -->
        <details>
          <summary>Edit</summary>
          <form action="{{ url_for('edit_task', task_id=t.id) }}" method="post">
            <label>Title <input name="title" value="{{ t.title }}" required></label><br>
            <label>Duration <input type="number" step="0.5" name="duration_days" value="{{ t.duration_days }}"></label><br>
            <label>Order <input type="number" min="1" name="order" value="{{ t.order }}"></label><br>

            {% if not t.assignment_id %}
              <label>Due <input type="date" name="due_date" value="{{ t.due_date }}" required></label><br>
              <label>Priority <input type="number" min="0" max="10" name="importance" value="{{ t.importance }}"></label><br>
            {% else %}
              <div><em>Due & priority come from assignment “{{ t.assignment_title }}”.</em></div>
            {% endif %}

            <label>Description<br><textarea name="description" rows="3" cols="40">{{ t.description }}</textarea></label><br>
            <button type="submit">Save</button>
          </form>
        </details>
        <hr>
      </li>
    {% else %}
      <p>No tasks yet.</p>
    {% endfor %}
  </ol>
  <script defer src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>